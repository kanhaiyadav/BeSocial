<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Create Post</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://kit.fontawesome.com/482c652b1c.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="../css/home.css" />
</head>

<body>
  <div id="head">
    <h2>Create a new post:</h2>
    <form id="new-post-form" action="/post/create" method="post">
      <textarea name="content" id="post" cols="30" rows="3"></textarea>
      <button class="sub-btn" type="submit">Post</button>
    </form>
  </div>

  <div id="posts-container">
    <%for(let post of posts){%>
    <div id="post-<%=post._id%>" class="post">

      <div>

        <div class="post-user"><i class="fa-solid fa-user"></i><span>@<%=post.user.name%></span></div>

        <p class="post-text">
          <%=post.content%>
        </p>

        <% if(locals.user && locals.user.id==post.user.id) {%>
        <a class="delete-link" href="/post/destroy/<%=post._id%>"><i class="fa-solid fa-trash-can"></i></a>
        <% } %>

        <button class="comment-btn" type="button"><i class="fa-solid fa-message"></i>Comments<i class="fa-solid fa-caret-down"></i></button>

        <div id="comments-container-<%=post._id %>" class="comment-container">
          <% for(comment of post.comments){ %>
          <div id="comment-<%=comment._id %>" class="comment">
            <div>
                <i class="fa-solid fa-user"></i><span>@<%=comment.user.name %></span>
                <% if(locals.user && (locals.user.id==comment.user.id || post.user.id==locals.user.id)){%>
                <a class="comment-delete-link" href="/comment/destroy/<%=comment._id%>"><i class="fa-solid fa-trash-can"></i></a>
                <% } %>
            </div>
            <p><%=comment.content%></p>
          </div>
          <% } %>
        </div>

      </div>


      <form class="comment-form" action="/comment/create" method="post">
        <textarea name="content" cols="45" rows="1" placeholder="Add a comment ..." required></textarea>
        <input type="hidden" value=<%=post._id%> name="post_id" />
        <button type="submit"><i class="fa-solid fa-paper-plane"></i></button>
      </form>

    </div>

    <% } %>
  </div>

  <script type="text/javascript" src="../js/home.js"></script>
</body>

</html>